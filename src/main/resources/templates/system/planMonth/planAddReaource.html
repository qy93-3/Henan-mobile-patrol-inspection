<!DOCTYPE HTML>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<link th:href="@{/css/select.css}" rel="stylesheet"/>
<head th:include="include :: header"></head>
<body class="gray-bg">

<div class="container-div">
    <div class="row">
        <div class="col-sm-12 select-table table-striped">
            <table id="bootstrap-table" data-mobile-responsive="true"></table>
        </div>
        <div>
            <a class="btn" style="background-color: #E9F4FF;color: #2A70A7;" onclick="distributeResource()"
               th:text="分配资源点"></a>
            <a class="btn" style="background-color: #E9F4FF;color: #2A70A7;" th:href="@{/system/planMonth/toDayDetile(date=${date},planMonthId=${planMonthId},from='month',sta='ing')}"
               th:text="返回计划列表"></a>
        </div>
    </div>
</div>
<div th:include="include :: footer"></div>
<script th:inline="javascript">
    var prefix = ctx + "system/planMonth";
    $(function () {
        console.log(2)
        var optionsResource = {
            url: prefix + "/resourceList?planMonthId=" + [[${planMonthId}]] + "&dateStr=" + [[${date}]],
            modalName: "资源点",
            search: false,
            showSearch: false,
            showRefresh: false,
            showToggle: false,
            showExport: false,
            showColumns: false,
            columns: [{
                checkbox: true
            },{
                field: 'resourceId',
                title: '资源点编号',
                sortable: true,
                visible: true
            },
                {
                    field: 'resourceName',
                    title: '资源点名称',
                    sortable: true
                },
                {
                    field: 'resourceLongitude',
                    title: '经度',
                    sortable: true,
                    visible: true
                },
                {
                    field: 'resourceLatitude',
                    title: '纬度',
                    sortable: true,
                    visible: true
                },
                {
                    field: 'resourceAddress',
                    title: '地址'
                },
                {
                    field: 'cycleName',
                    title: '巡检周期'
                },
                {
                    field: 'resourceLastDate',
                    title: '上次巡检日期',
                    sortable: true
                },
                {
                    field: 'resourceType',
                    title: '资源类型',
                    sortable: true,
                    visible: true
                }]
        };
        $.table.init(optionsResource);
    });
    function distributeResource() {
        var rows = $.common.isEmpty($.table._option.uniqueId) ? $.table.selectFirstColumns() : $.table.selectColumns($.table._option.uniqueId);
        if (rows.length == 0) {
            $.modal.alertWarning("请至少选择一条记录")
        } else {
            $.ajax({
                url: ctx + "system/planMonth/setResources",
                type: "post",
                dataType: "json",
                data: {"ids": rows.join(),"type":"resource", "dateStr": [[${date}]], "planMonthId": [[${planMonthId}]]},
                success: function (result) {
                    $.operate.ajaxSuccess(result);
                    location.href = "/system/planMonth/toDayDetile?date=" + [[${date}]] + "&planMonthId=" + [[${planMonthId}]]+"&from=month&sta=ing";
                }
            });
        }
    }
</script>
</body>
</html>